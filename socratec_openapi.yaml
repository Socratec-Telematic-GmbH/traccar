openapi: 3.1.0
info:
  title: Socratec Traccar Extensions
  description: Socratec-specific extensions to the Traccar GPS tracking server API. This includes additional endpoints and models for enhanced trip management functionality.
  contact:
    name: Socratec Telematic GmbH
    url: https://www.socratec.de/
    email: support@socratec.de
  license:
    name: Apache 2.0
    url: https://www.apache.org/licenses/LICENSE-2.0.html
  version: '1.0.0'
servers:
  - url: http://{host}:{port}/api
    description: Socratec Server
    variables:
      host:
        default: localhost
      port:
        enum:
          - '8082'
          - '80'
        default: '8082'
security:
  - BasicAuth: []
  - ApiKey: []
tags:
  - name: Trips
    description: Trip management and logbook functionality
  - name: Reports
    description: Report generation endpoints for logbook and trip data
  - name: Carriers
    description: Carrier management for vessel and vehicle tracking
paths:
  /trips:
    get:
      summary: Fetch a list of Trips
      description: Without params, it returns a list of Trips the user has access to
      tags:
        - Trips
      parameters:
        - name: all
          in: query
          description: Can only be used by admins or managers to fetch all entities
          schema:
            type: boolean
        - name: userId
          in: query
          description: Standard users can use this only with their own _userId_
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Trip'
        '400':
          description: No permission
          content: {}
    post:
      summary: Create a Trip (Not Supported)
      description: Trip creation is not supported. This endpoint returns HTTP 405 Method Not Allowed.
      tags:
        - Trips
      responses:
        '405':
          description: Method Not Allowed - Trip creation is not supported
          content: {}
  /trips/{id}:
    get:
      summary: Get a single Trip
      tags:
        - Trips
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Trip'
        '404':
          description: Trip not found
          content: {}
        '400':
          description: No permission
          content: {}
    put:
      summary: Update a Trip
      tags:
        - Trips
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Trip'
        required: true
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Trip'
        '404':
          description: Trip not found
          content: {}
        '400':
          description: No permission or validation error
          content: {}
      x-codegen-request-body-name: body
    delete:
      summary: Delete a Trip (Not Supported)
      description: Trip deletion is not supported. This endpoint returns HTTP 405 Method Not Allowed.
      tags:
        - Trips
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '405':
          description: Method Not Allowed - Trip deletion is not supported
          content: {}
  /carriers:
    get:
      summary: Fetch a list of Carriers
      description: |
        Retrieve carrier information for devices. Without parameters, returns carriers for devices 
        the user has access to. Carriers associate external carrier IDs (such as vessel MMSI numbers 
        or vehicle identifiers) with tracked devices.
      tags:
        - Carriers
      parameters:
        - name: all
          in: query
          description: Can only be used by admins to fetch all carriers
          schema:
            type: boolean
        - name: userId
          in: query
          description: Filter carriers by user ID. Standard users can only use their own userId
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Successfully retrieved list of carriers
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Carrier'
              example:
                - id: 123
                  carrierId: "211281610"
                  type: 0
                  createdAt: "2024-12-06T15:30:00.000Z"
                - id: 124
                  carrierId: "SHIP-ABC-001"
                  type: 0
                  createdAt: "2024-12-05T10:15:00.000Z"
        '400':
          description: No permission or invalid parameters
          content: {}
        '401':
          description: Unauthorized - Authentication required
          content: {}
    post:
      summary: Create a Carrier
      description: |
        Associates a carrier identifier with a device. The carrier ID is typically an external 
        identifier such as a vessel MMSI number or vehicle identification. The device must exist 
        and the user must have permission to access it.
      tags:
        - Carriers
      requestBody:
        required: true
        description: Carrier object to create. The id field represents the device ID.
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Carrier'
            example:
              id: 123
              carrierId: "211281610"
              type: 0
      responses:
        '200':
          description: Carrier successfully created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Carrier'
              example:
                id: 123
                carrierId: "211281610"
                type: 0
                createdAt: "2024-12-06T15:30:00.000Z"
        '400':
          description: |
            Bad request. This can occur when:
            - id field is missing or zero
            - carrierId is missing or empty
            - Invalid field values
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                example:
                  error: "carrierId is required"
        '404':
          description: Device not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                example:
                  error: "Device not found"
        '401':
          description: Unauthorized - Authentication required
          content: {}
        '403':
          description: Forbidden - User does not have permission to access this device
          content: {}
  /carriers/{deviceId}:
    put:
      summary: Update a Carrier
      description: |
        Updates the carrier information associated with a device. Allows modification of the 
        carrier ID and type. The device ID in the URL path must match the device ID in the 
        request body. The original creation timestamp is preserved.
      tags:
        - Carriers
      parameters:
        - name: deviceId
          in: path
          required: true
          description: The device ID whose carrier information should be updated
          schema:
            type: integer
            format: int64
          example: 123
      requestBody:
        required: true
        description: Updated carrier object. The id field must match the deviceId parameter.
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Carrier'
            example:
              id: 123
              carrierId: "211281999"
              type: 0
      responses:
        '200':
          description: Carrier successfully updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Carrier'
              example:
                id: 123
                carrierId: "211281999"
                type: 0
                createdAt: "2024-12-06T15:30:00.000Z"
        '400':
          description: |
            Bad request. This can occur when:
            - Device ID in path doesn't match ID in request body
            - carrierId is missing or empty
            - Invalid field values
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
              examples:
                mismatch:
                  value:
                    error: "Device ID mismatch"
                missing:
                  value:
                    error: "carrierId is required"
        '401':
          description: Unauthorized - Authentication required
          content: {}
        '403':
          description: Forbidden - User does not have permission to access this device
          content: {}
        '404':
          description: Carrier not found for this device
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                example:
                  error: "Carrier not found for this device"
    delete:
      summary: Remove a Carrier
      description: |
        Removes the carrier association from a device. This does not delete the device itself,
        only the carrier information linked to it.
      tags:
        - Carriers
      parameters:
        - name: deviceId
          in: path
          required: true
          description: The device ID whose carrier association should be removed
          schema:
            type: integer
            format: int64
          example: 123
      responses:
        '204':
          description: Carrier successfully removed
          content: {}
        '401':
          description: Unauthorized - Authentication required
          content: {}
        '403':
          description: Forbidden - User does not have permission to access this device
          content: {}
        '404':
          description: Device or carrier not found
          content: {}
  /logbook:
    post:
      summary: Create single LogbookEntry (Service Users Only)
      description: |
        Creates a single logbook entry in the system. This endpoint is restricted to service users only
        and requires authentication with a service account token. Regular users will receive a 403 Forbidden response.
        
        Service users are authenticated using the Bearer token scheme with a service account token
        configured via the `web.serviceAccountToken` configuration property.
        
        The endpoint validates required fields and automatically calculates duration if not provided.
        All creation actions are logged for audit purposes.
      tags:
        - Reports
      security:
        - ApiKey: []
      requestBody:
        required: true
        description: |
          LogbookEntry object to create. The ID field will be auto-generated and should not be provided.
          Required fields: deviceId, driverId, startPositionId, endPositionId, startTime, endTime, hash. 
          Duration will be calculated automatically if not provided.
        content:
          application/json:
            schema:
              type: object
              properties:
                deviceId:
                  type: integer
                  format: int64
                  description: ID of the device for this trip (required)
                  minimum: 1
                driverId:
                  type: integer
                  format: int64
                  description: ID of the driver who performed this trip (required)
                  minimum: 1
                startPositionId:
                  type: integer
                  format: int64
                  description: ID of the position record at trip start (required)
                  minimum: 1
                endPositionId:
                  type: integer
                  format: int64
                  description: ID of the position record at trip end (required)
                  minimum: 1
                startTime:
                  type: string
                  format: date-time
                  description: Trip start time in ISO 8601 format (required)
                endTime:
                  type: string
                  format: date-time
                  description: Trip end time in ISO 8601 format (required)
                hash:
                  type: string
                  description: Hash value for the trip (required for deduplication/integrity)
                  minLength: 1
                distance:
                  type: number
                  format: double
                  description: Total distance of the trip in meters
                  minimum: 0
                averageSpeed:
                  type: number
                  format: double
                  description: Average speed during the trip in km/h
                  minimum: 0
                maxSpeed:
                  type: number
                  format: double
                  description: Maximum speed reached during the trip in km/h
                  minimum: 0
                spentFuel:
                  type: number
                  format: double
                  description: Amount of fuel consumed during the trip in liters
                  minimum: 0
                startOdometer:
                  type: number
                  format: double
                  description: Odometer reading at trip start
                  minimum: 0
                endOdometer:
                  type: number
                  format: double
                  description: Odometer reading at trip end
                  minimum: 0
                startLat:
                  type: number
                  format: double
                  description: Latitude coordinate at trip start
                  minimum: -90
                  maximum: 90
                startLon:
                  type: number
                  format: double
                  description: Longitude coordinate at trip start
                  minimum: -180
                  maximum: 180
                endLat:
                  type: number
                  format: double
                  description: Latitude coordinate at trip end
                  minimum: -90
                  maximum: 90
                endLon:
                  type: number
                  format: double
                  description: Longitude coordinate at trip end
                  minimum: -180
                  maximum: 180
                startAddress:
                  type: string
                  maxLength: 512
                  description: Human-readable address at trip start location
                  nullable: true
                endAddress:
                  type: string
                  maxLength: 512
                  description: Human-readable address at trip end location
                  nullable: true
                duration:
                  type: integer
                  format: int64
                  description: Trip duration in milliseconds (auto-calculated if not provided)
                  minimum: 0
                notes:
                  type: string
                  description: Additional notes or comments for the trip
                  nullable: true
                type:
                  $ref: '#/components/schemas/LogbookEntryType'
              required:
                - deviceId
                - driverId
                - startPositionId
                - endPositionId
                - startTime
                - endTime
                - hash
            example:
              deviceId: 123
              driverId: 1
              startPositionId: 1
              endPositionId: 2
              startTime: "2024-11-07T08:00:00.000Z"
              endTime: "2024-11-07T10:30:00.000Z"
              distance: 125.7
              averageSpeed: 65.3
              maxSpeed: 95.0
              startLat: 52.520008
              startLon: 13.404954
              endLat: 52.370216
              endLon: 13.404954
              startAddress: "Berlin, Alexanderplatz, Germany"
              endAddress: "Berlin, Tempelhof Airport, Germany"
              notes: "Business trip to client meeting"
              type: 1
              hash: "a1b2c3d4e5f6789012345abcdef67890"
      responses:
        '200':
          description: |
            LogbookEntry successfully created. Returns the created LogbookEntry object.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LogbookEntry'
              example:
                id: 456
                deviceId: 123
                startTime: "2024-11-07T08:00:00.000Z"
                endTime: "2024-11-07T10:30:00.000Z"
                duration: 9000000
                distance: 125.7
                averageSpeed: 65.3
                maxSpeed: 95.0
                startLat: 52.520008
                startLon: 13.404954
                endLat: 52.370216
                endLon: 13.404954
                startAddress: "Berlin, Alexanderplatz, Germany"
                endAddress: "Berlin, Tempelhof Airport, Germany"
                notes: "Business trip to client meeting"
                type: 1
        '400':
          description: |
            Bad request. This can occur when:
            - Entry is null
            - Required fields are missing
            - Validation errors (e.g., endTime before startTime)
            - Invalid field values
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Missing required hash."
        '401':
          description: Unauthorized - Authentication required
          content: {}
        '403':
          description: |
            Forbidden - Access denied. This endpoint is restricted to service users only.
            Regular users and administrators cannot create logbook entries through this endpoint.
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Access denied: Service account required"
        '500':
          description: Internal server error
          content: {}
  /logbook/bulk:
    post:
      summary: Create multiple LogbookEntries (Service Users Only)
      description: |
        Creates multiple logbook entries in the system with partial success support. This endpoint is restricted to service users only
        and requires authentication with a service account token. Regular users will receive a 403 Forbidden response.
        
        The endpoint processes each entry individually and returns detailed results for both successful and failed entries.
        Even if some entries fail validation or processing, successful entries will still be created.
        
        Service users are authenticated using the Bearer token scheme with a service account token
        configured via the `web.serviceAccountToken` configuration property.
        
        The endpoint validates required fields and automatically calculates duration if not provided.
        All creation actions are logged for audit purposes.
      tags:
        - Reports
      security:
        - ApiKey: []
      requestBody:
        required: true
        description: |
          Array of LogbookEntry objects to create. The ID field will be auto-generated for each entry and should not be provided.
          Required fields per entry: deviceId, driverId, startPositionId, endPositionId, startTime, endTime, hash. 
          Duration will be calculated automatically if not provided.
        content:
          application/json:
            schema:
              type: array
              items:
                type: object
                properties:
                  deviceId:
                    type: integer
                    format: int64
                    description: ID of the device for this trip (required)
                    minimum: 1
                  driverId:
                    type: integer
                    format: int64
                    description: ID of the driver who performed this trip (required)
                    minimum: 1
                  startPositionId:
                    type: integer
                    format: int64
                    description: ID of the position record at trip start (required)
                    minimum: 1
                  endPositionId:
                    type: integer
                    format: int64
                    description: ID of the position record at trip end (required)
                    minimum: 1
                  startTime:
                    type: string
                    format: date-time
                    description: Trip start time in ISO 8601 format (required)
                  endTime:
                    type: string
                    format: date-time
                    description: Trip end time in ISO 8601 format (required)
                  hash:
                    type: string
                    description: Hash value for the trip (required for deduplication/integrity)
                    minLength: 1
                  distance:
                    type: number
                    format: double
                    description: Total distance of the trip in meters
                    minimum: 0
                  averageSpeed:
                    type: number
                    format: double
                    description: Average speed during the trip in km/h
                    minimum: 0
                  maxSpeed:
                    type: number
                    format: double
                    description: Maximum speed reached during the trip in km/h
                    minimum: 0
                  spentFuel:
                    type: number
                    format: double
                    description: Amount of fuel consumed during the trip in liters
                    minimum: 0
                  startOdometer:
                    type: number
                    format: double
                    description: Odometer reading at trip start
                    minimum: 0
                  endOdometer:
                    type: number
                    format: double
                    description: Odometer reading at trip end
                    minimum: 0
                  startLat:
                    type: number
                    format: double
                    description: Latitude coordinate at trip start
                    minimum: -90
                    maximum: 90
                  startLon:
                    type: number
                    format: double
                    description: Longitude coordinate at trip start
                    minimum: -180
                    maximum: 180
                  endLat:
                    type: number
                    format: double
                    description: Latitude coordinate at trip end
                    minimum: -90
                    maximum: 90
                  endLon:
                    type: number
                    format: double
                    description: Longitude coordinate at trip end
                    minimum: -180
                    maximum: 180
                  startAddress:
                    type: string
                    maxLength: 512
                    description: Human-readable address at trip start location
                    nullable: true
                  endAddress:
                    type: string
                    maxLength: 512
                    description: Human-readable address at trip end location
                    nullable: true
                  duration:
                    type: integer
                    format: int64
                    description: Trip duration in milliseconds (auto-calculated if not provided)
                    minimum: 0
                  notes:
                    type: string
                    description: Additional notes or comments for the trip
                    nullable: true
                  type:
                    $ref: '#/components/schemas/LogbookEntryType'
                required:
                  - deviceId
                  - driverId
                  - startPositionId
                  - endPositionId
                  - startTime
                  - endTime
                  - hash
            example:
              - deviceId: 123
                driverId: 1
                startPositionId: 1
                endPositionId: 2
                startTime: "2024-11-07T08:00:00.000Z"
                endTime: "2024-11-07T10:30:00.000Z"
                distance: 125.7
                averageSpeed: 65.3
                maxSpeed: 95.0
                startLat: 52.520008
                startLon: 13.404954
                endLat: 52.370216
                endLon: 13.404954
                startAddress: "Berlin, Alexanderplatz, Germany"
                endAddress: "Berlin, Tempelhof Airport, Germany"
                notes: "Business trip to client meeting"
                type: 1
                hash: "a1b2c3d4e5f6789012345abcdef67890"
              - deviceId: 124
                driverId: 2
                startPositionId: 3
                endPositionId: 4
                startTime: "2024-11-07T11:00:00.000Z"
                endTime: "2024-11-07T12:30:00.000Z"
                distance: 85.2
                averageSpeed: 55.8
                maxSpeed: 80.0
                startLat: 52.370216
                startLon: 13.404954
                endLat: 52.520008
                endLon: 13.404954
                startAddress: "Berlin, Tempelhof Airport, Germany"
                endAddress: "Berlin, Alexanderplatz, Germany"
                notes: "Return trip"
                type: 1
                hash: "b2c3d4e5f6789012345abcdef67890a1"
      responses:
        '200':
          description: |
            All entries processed successfully. Returns detailed results with all created LogbookEntry objects.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LogbookEntriesResult'
              example:
                totalRequested: 2
                successful: 2
                failed: 0
                results:
                  - index: 0
                    status: "success"
                    entry:
                      id: 456
                      deviceId: 123
                      startTime: "2024-11-07T08:00:00.000Z"
                      endTime: "2024-11-07T10:30:00.000Z"
                      duration: 9000000
                      distance: 125.7
                      averageSpeed: 65.3
                      maxSpeed: 95.0
                      startLat: 52.520008
                      startLon: 13.404954
                      endLat: 52.370216
                      endLon: 13.404954
                      startAddress: "Berlin, Alexanderplatz, Germany"
                      endAddress: "Berlin, Tempelhof Airport, Germany"
                      notes: "Business trip to client meeting"
                      type: 1
                  - index: 1
                    status: "success"
                    entry:
                      id: 457
                      deviceId: 124
                      startTime: "2024-11-07T11:00:00.000Z"
                      endTime: "2024-11-07T12:30:00.000Z"
                      duration: 5400000
                      distance: 85.2
                      averageSpeed: 55.8
                      maxSpeed: 80.0
                      startLat: 52.370216
                      startLon: 13.404954
                      endLat: 52.520008
                      endLon: 13.404954
                      startAddress: "Berlin, Tempelhof Airport, Germany"
                      endAddress: "Berlin, Alexanderplatz, Germany"
                      notes: "Return trip"
                      type: 1
        '207':
          description: |
            Partial success - Some entries were created successfully, others failed.
            Returns detailed results showing which entries succeeded and which failed with error messages.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LogbookEntriesResult'
              example:
                totalRequested: 3
                successful: 2
                failed: 1
                results:
                  - index: 0
                    status: "success"
                    entry:
                      id: 456
                      deviceId: 123
                      # ... complete LogbookEntry object
                  - index: 1
                    status: "error"
                    error: "Missing required hash."
                    originalEntry:
                      deviceId: 124
                      driverId: 2
                      # ... the failed entry data
                  - index: 2
                    status: "success"
                    entry:
                      id: 457
                      deviceId: 125
                      # ... complete LogbookEntry object
        '400':
          description: |
            Bad request. This can occur when:
            - Entry list is null or empty
            - All entries failed validation or processing
            - Invalid request format
          content:
            application/json:
              schema:
                oneOf:
                  - type: object
                    properties:
                      error:
                        type: string
                        example: "Entry list cannot be null or empty"
                  - $ref: '#/components/schemas/LogbookEntriesResult'
        '401':
          description: Unauthorized - Authentication required
          content: {}
        '403':
          description: |
            Forbidden - Access denied. This endpoint is restricted to service users only.
            Regular users and administrators cannot create logbook entries through this endpoint.
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Access denied: Service account required"
        '500':
          description: Internal server error
          content: {}
  /logbook/{id}:
    put:
      summary: Update LogbookEntry type and notes
      description: |
        Updates ONLY the type and notes fields of a LogbookEntry for trip classification and annotation.
        All other fields in the request body are ignored and remain unchanged.
        This endpoint is used to classify trips as BUSINESS (1) or PRIVATE (2) and add notes.
      tags:
        - Reports
      parameters:
        - name: id
          in: path
          required: true
          description: The ID of the LogbookEntry to update
          schema:
            type: integer
            format: int64
          example: 123
      requestBody:
        required: true
        description: |
          LogbookEntry object with the type and/or notes fields to update.
          Only the 'type' and 'notes' fields will be processed - all other fields are ignored.
        content:
          application/json:
            schema:
              type: object
              properties:
                type:
                  $ref: '#/components/schemas/LogbookEntryType'
                notes:
                  type: string
                  description: Additional notes or comments for the trip
                  nullable: true
              required:
                - type
            example:
              type: 1
              notes: "Business meeting in Berlin"
      responses:
        '200':
          description: |
            Successfully updated the LogbookEntry type and/or notes.
            Returns the complete LogbookEntry object with the updated fields.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LogbookEntry'
              example:
                id: 123
                deviceId: 1
                distance: 150.5
                averageSpeed: 45.2
                maxSpeed: 80.0
                spentFuel: 12.5
                startOdometer: 1000.0
                endOdometer: 1150.5
                startTime: "2024-01-01T08:00:00.000Z"
                endTime: "2024-01-01T10:30:00.000Z"
                startPositionId: 123
                endPositionId: 124
                startLat: 52.5200
                startLon: 13.4050
                endLat: 52.5300
                endLon: 13.4150
                startAddress: "Berlin, Germany"
                endAddress: "Berlin, Germany"
                duration: 9000000
                driverId: 1
                notes: "Business meeting in Berlin"
                type: 1
        '400':
          description: |
            Bad request. This can occur when:
            - Invalid type value (must be 1 or 2)
            - Missing required 'type' field in request body
            - Invalid request format
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Invalid type value. Must be 1 (BUSINESS) or 2 (PRIVATE)"
        '404':
          description: LogbookEntry not found
          content: {}
        '401':
          description: Unauthorized - Authentication required
          content: {}
        '403':
          description: |
            Forbidden - User does not have permission to access or modify the device
            associated with this LogbookEntry.
          content: {}
        '500':
          description: Internal server error
          content: {}
  /reports/logbook:
    get:
      summary: Get logbook report (JSON)
      description: |
        Generate a logbook report filtered by device, group, and date range.
        Returns LogbookEntry objects in JSON format, ordered by startTime.
        This is the primary endpoint for logbook reporting functionality.
      tags:
        - Reports
      parameters:
        - name: deviceId
          in: query
          description: |
            List of device IDs to include. Multiple device IDs can be specified.
          required: false
          schema:
            type: array
            items:
              type: integer
              format: int64
          style: form
          explode: true
          example: [1, 2, 3]
        - name: groupId
          in: query
          description: |
            List of group IDs to include. All devices in the specified groups will be included.
            Multiple group IDs can be specified.
          required: false
          schema:
            type: array
            items:
              type: integer
              format: int64
          style: form
          explode: true
          example: [1, 2]
        - name: from
          in: query
          description: |
            Start date and time for filtering in ISO 8601 format.
            Only trips starting on or after this date will be included.
          required: true
          schema:
            type: string
            format: date-time
          example: "2024-01-01T00:00:00.000Z"
        - name: to
          in: query
          description: |
            End date and time for filtering in ISO 8601 format.
            Only trips starting on or before this date will be included.
          required: true
          schema:
            type: string
            format: date-time
          example: "2024-01-31T23:59:59.999Z"
      responses:
        '200':
          description: |
            Successfully retrieved filtered LogbookEntry objects.
            Results are ordered by startTime.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/LogbookEntry'
              example:
                - id: 1
                  deviceId: 1
                  distance: 150.5
                  averageSpeed: 45.2
                  maxSpeed: 80.0
                  spentFuel: 12.5
                  startOdometer: 1000.0
                  endOdometer: 1150.5
                  startTime: "2024-01-01T08:00:00.000Z"
                  endTime: "2024-01-01T10:30:00.000Z"
                  startPositionId: 123
                  endPositionId: 124
                  startLat: 52.5200
                  startLon: 13.4050
                  endLat: 52.5300
                  endLon: 13.4150
                  startAddress: "Berlin, Germany"
                  endAddress: "Berlin, Germany"
                  duration: 9000000
                  driverId: 1
                  notes: "Business meeting in Berlin"
                  type: 1
        '400':
          description: |
            Bad request. This can occur when:
            - Required parameters (from, to) are missing
            - Date format is incorrect
            - Date range exceeds configured limits
            - Invalid parameter values
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Both 'from' and 'to' parameters are required for filtered queries"
        '401':
          description: Unauthorized - Authentication required
          content: {}
        '403':
          description: |
            Forbidden - User does not have permission to access the specified devices or groups,
            or reports are disabled for this user.
          content: {}
        '500':
          description: Internal server error
          content: {}
  /reports/logbook/{type}:
    get:
      summary: Get logbook report (Excel/PDF)
      description: |
        Endpoint for generating logbook reports in multiple formats.
        Supports 'xlsx' for Excel download, 'pdf' for PDF download, and 'mail' for email delivery.
        Returns a formatted file with enhanced logbook entries including separate sheets per device (Excel),
        formatted pages with summary calculations and entry tables (PDF), or sends via email.
      tags:
        - Reports
      parameters:
        - name: type
          in: path
          required: true
          description: Report delivery type - 'xlsx' for Excel download, 'pdf' for PDF download, 'mail' for email
          schema:
            type: string
            enum: [xlsx, pdf, mail]
          example: "xlsx"
        - name: deviceId
          in: query
          description: |
            List of device IDs to include. Multiple device IDs can be specified.
          required: false
          schema:
            type: array
            items:
              type: integer
              format: int64
          style: form
          explode: true
          example: [1, 2, 3]
        - name: groupId
          in: query
          description: |
            List of group IDs to include. All devices in the specified groups will be included.
            Multiple group IDs can be specified.
          required: false
          schema:
            type: array
            items:
              type: integer
              format: int64
          style: form
          explode: true
          example: [1, 2]
        - name: from
          in: query
          description: |
            Start date and time for filtering in ISO 8601 format.
            Only trips starting on or after this date will be included.
          required: true
          schema:
            type: string
            format: date-time
          example: "2024-01-01T00:00:00.000Z"
        - name: to
          in: query
          description: |
            End date and time for filtering in ISO 8601 format.
            Only trips starting on or before this date will be included.
          required: true
          schema:
            type: string
            format: date-time
          example: "2024-01-31T23:59:59.999Z"
      responses:
        '200':
          description: |
            Successfully generated logbook report for direct download.
            For type=xlsx: Returns an Excel file with enhanced logbook entries and separate sheets per device.
            For type=pdf: Returns a PDF document with formatted logbook entries, summary calculations, and professional layout.
          content:
            application/vnd.openxmlformats-officedocument.spreadsheetml.sheet:
              schema:
                type: string
                format: binary
            application/pdf:
              schema:
                type: string
                format: binary
          headers:
            Content-Disposition:
              description: Attachment header with filename
              schema:
                type: string
                example: "attachment; filename=report.xlsx"
        '204':
          description: |
            Email successfully dispatched (type=mail).
            The logbook report has been sent to the user's email address.
            No content is returned in the response body.
          content: {}
        '400':
          description: |
            Bad request. This can occur when:
            - Required parameters (from, to) are missing
            - Date format is incorrect
            - Date range exceeds configured limits
            - Invalid parameter values
            - Invalid type parameter (must be 'xlsx', 'pdf', or 'mail')
          content: {}
        '401':
          description: Unauthorized - Authentication required
          content: {}
        '403':
          description: |
            Forbidden - User does not have permission to access the specified devices or groups,
            or reports are disabled for this user.
          content: {}
        '500':
          description: Internal server error
          content: {}
components:
  schemas:
    Trip:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: Unique identifier for the trip
        deviceId:
          type: integer
          format: int64
          description: ID of the device that performed this trip
        distance:
          type: number
          format: double
          description: Total distance of the trip in meters
        averageSpeed:
          type: number
          format: double
          description: Average speed during the trip in km/h
        maxSpeed:
          type: number
          format: double
          description: Maximum speed reached during the trip in km/h
        spentFuel:
          type: number
          format: double
          description: Amount of fuel consumed during the trip in liters
        startOdometer:
          type: number
          format: double
          description: Odometer reading at trip start
        endOdometer:
          type: number
          format: double
          description: Odometer reading at trip end
        startTime:
          type: string
          format: date-time
          description: Trip start time in ISO 8601 format. eg. `1963-11-22T18:30:00Z`
        endTime:
          type: string
          format: date-time
          description: Trip end time in ISO 8601 format. eg. `1963-11-22T18:30:00Z`
        startPositionId:
          type: integer
          format: int64
          description: ID of the position record at trip start
        endPositionId:
          type: integer
          format: int64
          description: ID of the position record at trip end
        startLat:
          type: number
          format: double
          description: Latitude coordinate at trip start
        startLon:
          type: number
          format: double
          description: Longitude coordinate at trip start
        endLat:
          type: number
          format: double
          description: Latitude coordinate at trip end
        endLon:
          type: number
          format: double
          description: Longitude coordinate at trip end
        startAddress:
          type: string
          maxLength: 512
          description: Human-readable address at trip start location
          nullable: true
        endAddress:
          type: string
          maxLength: 512
          description: Human-readable address at trip end location
          nullable: true
        duration:
          type: integer
          format: int64
          description: Trip duration in milliseconds
        driverId:
          type: integer
          format: int64
          description: ID of the driver who performed this trip
          nullable: true
      required:
        - deviceId
        - distance
        - averageSpeed
        - maxSpeed
        - spentFuel
        - startOdometer
        - endOdometer
        - startTime
        - endTime
        - startPositionId
        - endPositionId
        - startLat
        - startLon
        - endLat
        - endLon
        - duration
    LogbookEntry:
      type: object
      description: |
        Represents a logbook entry containing detailed trip information.
        LogbookEntry objects are stored in the tc_trips database table and contain
        comprehensive trip data including location, timing, fuel consumption, and classification.
      properties:
        id:
          type: integer
          format: int64
          description: Unique identifier for the logbook entry
        deviceId:
          type: integer
          format: int64
          description: ID of the device that performed this trip
        distance:
          type: number
          format: double
          description: Total distance of the trip in meters
        averageSpeed:
          type: number
          format: double
          description: Average speed during the trip in km/h
        maxSpeed:
          type: number
          format: double
          description: Maximum speed reached during the trip in km/h
        spentFuel:
          type: number
          format: double
          description: Amount of fuel consumed during the trip in liters
        startOdometer:
          type: number
          format: double
          description: Odometer reading at trip start
        endOdometer:
          type: number
          format: double
          description: Odometer reading at trip end
        startTime:
          type: string
          format: date-time
          description: Trip start time in ISO 8601 format. eg. `2024-01-01T08:00:00.000Z`
        endTime:
          type: string
          format: date-time
          description: Trip end time in ISO 8601 format. eg. `2024-01-01T10:30:00.000Z`
        startPositionId:
          type: integer
          format: int64
          description: ID of the position record at trip start
        endPositionId:
          type: integer
          format: int64
          description: ID of the position record at trip end
        startLat:
          type: number
          format: double
          description: Latitude coordinate at trip start
          minimum: -90
          maximum: 90
        startLon:
          type: number
          format: double
          description: Longitude coordinate at trip start
          minimum: -180
          maximum: 180
        endLat:
          type: number
          format: double
          description: Latitude coordinate at trip end
          minimum: -90
          maximum: 90
        endLon:
          type: number
          format: double
          description: Longitude coordinate at trip end
          minimum: -180
          maximum: 180
        startAddress:
          type: string
          maxLength: 512
          description: Human-readable address at trip start location
          nullable: true
        endAddress:
          type: string
          maxLength: 512
          description: Human-readable address at trip end location
          nullable: true
        duration:
          type: integer
          format: int64
          description: Trip duration in milliseconds
          minimum: 0
        driverId:
          type: integer
          format: int64
          description: ID of the driver who performed this trip
        hash:
          type: string
          description: Hash value for the trip (required for deduplication/integrity)
          minLength: 1
        notes:
          type: string
          description: Additional notes or comments for the trip
          nullable: true
        type:
          $ref: '#/components/schemas/LogbookEntryType'
      required:
        - deviceId
        - distance
        - averageSpeed
        - maxSpeed
        - spentFuel
        - startOdometer
        - endOdometer
        - startTime
        - endTime
        - startPositionId
        - endPositionId
        - startLat
        - startLon
        - endLat
        - endLon
        - duration
        - driverId
        - hash
        - type
    LogbookEntryType:
      type: integer
      description: |
        Enum representing the type/classification of a logbook entry.
        Used to categorize trips for business reporting and tax purposes.
        Defaults to BUSINESS (1) if not provided during creation.
      enum: [1, 2]
      default: 1
      x-enum-varnames: [BUSINESS, PRIVATE]
      x-enum-descriptions:
        - "BUSINESS (1): Business-related trip (default)"
        - "PRIVATE (2): Private/personal trip"
      example: 1
    LogbookEntryCreateResult:
      type: object
      description: |
        Represents the result of attempting to create a single LogbookEntry during bulk operations.
        Contains either the successfully created entry or error information for failed entries.
      properties:
        index:
          type: integer
          description: Zero-based index of this entry in the original request array
          minimum: 0
        status:
          type: string
          enum: ["success", "error"]
          description: Status of the creation attempt
        entry:
          $ref: '#/components/schemas/LogbookEntry'
          description: The successfully created LogbookEntry (only present when status is "success")
        error:
          type: string
          description: Error message explaining why the creation failed (only present when status is "error")
        originalEntry:
          $ref: '#/components/schemas/LogbookEntry'
          description: The original entry data that failed to be created (only present when status is "error")
      required:
        - index
        - status
    LogbookEntriesResult:
      type: object
      description: |
        Response object for bulk LogbookEntry creation operations.
        Provides summary statistics and detailed results for each entry in the request.
      properties:
        totalRequested:
          type: integer
          description: Total number of entries in the original request
          minimum: 0
        successful:
          type: integer
          description: Number of entries that were successfully created
          minimum: 0
        failed:
          type: integer
          description: Number of entries that failed to be created
          minimum: 0
        results:
          type: array
          items:
            $ref: '#/components/schemas/LogbookEntryCreateResult'
          description: Detailed results for each entry, ordered by the original request index
      required:
        - totalRequested
        - successful
        - failed
        - results
    Carrier:
      type: object
      description: |
        Represents a carrier association for a device. Carriers link external identifiers 
        (such as vessel MMSI numbers or vehicle IDs) to tracked devices in the system.
        Stored in the tc_carriers database table.
      properties:
        id:
          type: integer
          format: int64
          description: Device ID (inherited from BaseModel, represents the device this carrier is associated with)
        carrierId:
          type: string
          description: External carrier identifier (e.g., vessel MMSI, vehicle ID). Required field.
          minLength: 1
          example: "211281610"
        type:
          $ref: '#/components/schemas/CarrierType'
        createdAt:
          type: string
          format: date-time
          description: Timestamp when the carrier association was created
          example: "2024-12-06T15:30:00.000Z"
      required:
        - id
        - carrierId
    CarrierType:
      type: integer
      description: |
        Enum representing the type of carrier.
        Currently supports VESSEL (0) as the primary carrier type.
        Defaults to VESSEL if not specified.
      enum: [0]
      default: 0
      x-enum-varnames: [VESSEL]
      x-enum-descriptions:
        - "VESSEL (0): Maritime vessel carrier type (default)"
      example: 0
  requestBodies:
    Trip:
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Trip'
      required: true
  securitySchemes:
    BasicAuth:
      type: http
      scheme: basic
    ApiKey:
      type: http
      scheme: bearer
